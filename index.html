<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√≥n qu√† t·∫∑ng Nhi nh√≥</title>
    <style>
        body { margin: 0; padding: 0; background-color: #000; overflow: hidden; font-family: 'Arial', sans-serif; }
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; }

        /* --- UI LAYER (Kh√¥ng gian 3D) --- */
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none;
            perspective: 1000px; /* T·∫°o chi·ªÅu s√¢u cho m·∫Øt nh√¨n */
        }

        /* --- CONTAINER: Ch·ªãu tr√°ch nhi·ªám V·ªä TR√ç bay v√≤ng tr√≤n --- */
        .gift-container {
            position: absolute;
            top: 50%; left: 50%; /* ƒê·∫∑t m·ªëc ·ªü gi·ªØa m√†n h√¨nh */
            width: 0; height: 0; /* Kh√¥ng c√≥ k√≠ch th∆∞·ªõc ƒë·ªÉ cƒÉn gi·ªØa d·ªÖ h∆°n */
            pointer-events: auto;
            transform-style: preserve-3d;
            cursor: pointer;
        }

        /* --- BOX: Ch·ªãu tr√°ch nhi·ªám H√åNH D√ÅNG 3D v√† T·ª∞ XOAY --- */
        .gift-box {
            position: absolute;
            top: -30px; left: -30px; /* CƒÉn gi·ªØa h·ªôp 60px v√†o t√¢m c·ªßa container */
            width: 30px; height: 30px;
            transform-style: preserve-3d;
            animation: spinGift 5s infinite linear; /* H·ªôp t·ª± xoay */
        }

        /* --- C√ÅC M·∫∂T C·ª¶A H·ªòP QU√Ä --- */
        .face {
            position: absolute;
            width: 30px; height: 30px;
            background-color: #cc0000; /* ƒê·ªè */
            border: 1px solid #ff3333;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5);
            opacity: 0.95;
        }

        /* RUY BƒÇNG V√ÄNG */
        .face::before {
            content: ''; position: absolute;
            width: 12px; height: 100%;
            background-color: #FFD700;
            left: 50%; transform: translateX(-50%);
        }
        .face::after {
            content: ''; position: absolute;
            width: 100%; height: 12px;
            background-color: #FFD700;
            top: 50%; transform: translateY(-50%);
        }
        /* B·ªè ruy bƒÉng ngang ·ªü m·∫∑t tr√™n/d∆∞·ªõi cho ƒë·ª° r·ªëi */
        .top::after, .bottom::after { display: none; }
        .top::before, .bottom::before { width: 100%; height: 12px; top: 50%; transform: translateY(-50%) rotate(90deg); }

        /* GH√âP 6 M·∫∂T TH√ÄNH H√åNH L·∫¨P PH∆Ø∆†NG */
        .front  { transform: translateZ(30px); }
        .back   { transform: rotateY(180deg) translateZ(30px); }
        .right  { transform: rotateY(90deg) translateZ(30px); }
        .left   { transform: rotateY(-90deg) translateZ(30px); }
        .top    { transform: rotateX(90deg) translateZ(30px); background-color: #e60000; }
        .bottom { transform: rotateX(-90deg) translateZ(30px); }

        @keyframes spinGift {
            0% { transform: rotateX(0deg) rotateY(0deg); }
            100% { transform: rotateX(360deg) rotateY(360deg); }
        }

        /* --- LIGHTBOX (Xem ·∫£nh) --- */
        #lightbox {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 20;
            display: none; justify-content: center; align-items: center;
            pointer-events: auto;
        }
        #lightbox img {
            max-width: 90%; max-height: 90%;
            border: 5px solid #fff;
            border-radius: 10px;
            box-shadow: 0 0 50px rgba(255,255,255,0.3);
            transform: scale(0);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* --- TEXT MERRY CHRISTMAS --- */
        #final-text {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 100%; text-align: center;
            opacity: 0; transition: opacity 2s;
            z-index: 5; pointer-events: none;
        }
        #final-text h1 {
            font-family: 'Courier New', monospace;
            font-size: 3rem; color: #00ff00;
            text-shadow: 0 0 20px #00ff00, 0 0 40px #ff0000;
            margin: 0; white-space: nowrap;
        }
        @media (min-width: 768px) { #final-text h1 { font-size: 5rem; } }

    </style>
</head>
<body>

    <canvas id="canvas"></canvas>
    <div id="ui-layer"></div>

    <div id="lightbox" onclick="closeLightbox()">
        <img id="lightbox-img" src="" alt="">
    </div>

    <div id="final-text">
        <h1>MERRY CHRISTMAS üéÑ</h1>
    </div>

    <script>
        // --- 1. THAY ·∫¢NH C·ª¶A B·∫†N V√ÄO ƒê√ÇY (ƒê·ªß 6 ·∫£nh) ---
        const myImages = [
            "Nhi1.jpg",
            "Nhi2.jpg",
            "Nhi3.jpg",
            "Nhi4.jpg",
            "Nhi5.jpg",
            "Nhi6.jpg"
        ];

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const uiLayer = document.getElementById('ui-layer');

        let width, height;
        let particles = [];
        let giftContainers = []; // M·∫£ng ch·ª©a c√°c h·ªôp qu√†
        let state = 0; // 0: C√¢y th√¥ng, 1: H·ªôp qu√† bay, 2: K·∫øt th√∫c
        let angleY = 0;
        let openedGiftsCount = 0;

        const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#00FFFF', '#FF00FF', '#FFFFFF'];

        // --- H·ªÜ TH·ªêNG H·∫†T (C√¢y th√¥ng & N·ªÅn) ---
        class Particle {
            constructor() {
                this.reset();
            }

            reset() {
                this.x = 0; this.y = 0; this.z = 0;
                this.tx = 0; this.ty = 0; this.tz = 0;
                this.vx = 0; this.vy = 0; this.vz = 0;
                this.color = colors[Math.floor(Math.random() * colors.length)];
                this.size = Math.random() * 3 + 1;
                this.setTreeTarget();

                // Kh·ªüi t·∫°o v·ªã tr√≠ ng·∫´u nhi√™n
                this.x = (Math.random() - 0.5) * window.innerWidth;
                this.y = (Math.random() - 0.5) * window.innerHeight;
                this.z = (Math.random() - 0.5) * 1000;
            }

            setTreeTarget() {
                // T·∫†O D√ÅNG C√ÇY TH√îNG
                this.ty = Math.random() * 900 - 450;
                let coneRadius = (this.ty + 450) * 0.55;
                const a = Math.random() * Math.PI * 2;
                const r = Math.random() * coneRadius;
                this.tx = Math.cos(a) * r;
                this.tz = Math.sin(a) * r;
            }

            explode() {
                // Hi·ªáu ·ª©ng n·ªï tung t√≥e
                this.vx = (Math.random() - 0.5) * 8;
                this.vy = (Math.random() - 0.5) * 8;
                this.vz = (Math.random() - 0.5) * 8;
            }

            update() {
                if (state === 0) {
                    // Bay v·ªÅ v·ªã tr√≠ c√¢y
                    this.x += (this.tx - this.x) * 0.05;
                    this.y += (this.ty - this.y) * 0.05;
                    this.z += (this.tz - this.z) * 0.05;
                } else {
                    // Bay t·ª± do
                    this.x += this.vx;
                    this.y += this.vy;
                    this.z += this.vz;
                    // ƒê·∫≠p t∆∞·ªùng quay l·∫°i
                    if(this.x > 2000 || this.x < -2000) this.vx *= -1;
                    if(this.y > 2000 || this.y < -2000) this.vy *= -1;
                }
            }

            draw(cosY, sinY) {
                const fov = 400;
                const rx = this.x * cosY - this.z * sinY;
                const rz = this.z * cosY + this.x * sinY;
                const scale = fov / (fov + rz + 800);

                if (scale > 0) {
                    const x2d = rx * scale + width / 2;
                    const y2d = this.y * scale + height / 2;
                    ctx.beginPath();
                    ctx.arc(x2d, y2d, this.size * scale, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
            }
        }

        function drawStar(cosY, sinY) {
            if (state !== 0) return;
            const fov = 400;
            const starY = -480;
            const rx = 0; const rz = 0; // T√¢m

            // Xoay theo tr·ª•c Y c√πng c√¢y
            // Ng√¥i sao n·∫±m tr√™n tr·ª•c Y n√™n x, z = 0, khi xoay v·∫´n l√† 0
            // Ch·ªâ c·∫ßn t√≠nh scale
            const scale = fov / (fov + rz + 800);
            const x2d = width / 2; // Lu√¥n ·ªü gi·ªØa
            const y2d = starY * scale + height / 2;

            if (scale > 0) {
                ctx.save();
                ctx.translate(x2d, y2d);
                ctx.beginPath();
                const spikes = 5;
                const outerRadius = 40 * scale;
                const innerRadius = 20 * scale;
                for (let i = 0; i < spikes * 2; i++) {
                    const r = (i % 2 === 0) ? outerRadius : innerRadius;
                    const angle = (Math.PI / spikes) * i - Math.PI / 2;
                    const sx = Math.cos(angle) * r;
                    const sy = Math.sin(angle) * r;
                    if (i === 0) ctx.moveTo(sx, sy); else ctx.lineTo(sx, sy);
                }
                ctx.closePath();
                ctx.fillStyle = "#FFD700";
                ctx.shadowBlur = 20;
                ctx.shadowColor = "#FFD700";
                ctx.fill();
                ctx.restore();
            }
        }

        // --- X·ª¨ L√ù H·ªòP QU√Ä 3D ---
        function createGifts() {
            uiLayer.innerHTML = '';
            giftContainers = [];

            // L·∫•y t·ªëi ƒëa 6 ·∫£nh
            const limit = Math.min(myImages.length, 6);

            for (let i = 0; i < limit; i++) {
                // 1. T·∫°o Container (ƒë·ªÉ di chuy·ªÉn v·ªã tr√≠)
                const container = document.createElement('div');
                container.className = 'gift-container';

                // 2. T·∫°o Box (ƒë·ªÉ xoay 3D)
                const box = document.createElement('div');
                box.className = 'gift-box';

                // 3. T·∫°o 6 m·∫∑t
                const faces = ['front', 'back', 'left', 'right', 'top', 'bottom'];
                faces.forEach(faceName => {
                    const face = document.createElement('div');
                    face.className = `face ${faceName}`;
                    box.appendChild(face);
                });

                // G·∫Øn Box v√†o Container
                container.appendChild(box);

                // L∆∞u g√≥c ƒë·ªÉ t√≠nh v·ªã tr√≠ v√≤ng tr√≤n
                // Chia ƒë·ªÅu 360 ƒë·ªô (2*PI) cho s·ªë l∆∞·ª£ng h·ªôp
                container.dataset.angleOffset = (i / limit) * Math.PI * 2;

                // Click m·ªü qu√†
                container.onclick = () => {
                    container.style.display = 'none'; // ·∫®n qu√† ƒë√£ m·ªü
                    openLightbox(myImages[i]);
                };

                uiLayer.appendChild(container);
                giftContainers.push(container);
            }
        }

        function updateGifts(angleY) {
            if (state !== 1) return;

            const radius = 280; // ƒê·ªô r·ªông v√≤ng xoay
            const fov = 400;

            giftContainers.forEach(container => {
                if (container.style.display === 'none') return;

                // T√≠nh g√≥c hi·ªán t·∫°i = G√≥c ri√™ng + G√≥c quay chung
                const currentAngle = parseFloat(container.dataset.angleOffset) + angleY;

                // T√≠nh t·ªça ƒë·ªô 3D
                const x = Math.cos(currentAngle) * radius;
                const z = Math.sin(currentAngle) * radius;

                // Ph√©p chi·∫øu 3D (Projection)
                const scale = fov / (fov + z + 0); // +0 v√¨ container g·ªëc ·ªü z=0

                // T√≠nh t·ªça ƒë·ªô m√†n h√¨nh (relative to center)
                const x2d = x * scale;
                const y2d = 0; // H·ªôp qu√† bay ngang t·∫ßm m·∫Øt (Y=0)

                // √Åp d·ª•ng Transform
                // D√πng translate3d ƒë·ªÉ m∆∞·ª£t h∆°n
                container.style.transform = `translate3d(${x2d}px, ${y2d}px, 0) scale(${scale})`;

                // S·∫Øp x·∫øp Z-index: H·ªôp n√†o ·ªü g·∫ßn (scale l·ªõn) th√¨ ƒë√® l√™n h·ªôp ·ªü xa
                container.style.zIndex = Math.floor(scale * 100);
            });
        }

        // --- X·ª¨ L√ù ·∫¢NH & LOGIC CHUNG ---
        function openLightbox(src) {
            const lightbox = document.getElementById('lightbox');
            const img = document.getElementById('lightbox-img');
            img.src = src;
            lightbox.style.display = 'flex';
            setTimeout(() => { img.style.transform = 'scale(1)'; }, 50);
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            const img = document.getElementById('lightbox-img');
            img.style.transform = 'scale(0)';

            setTimeout(() => {
                lightbox.style.display = 'none';
                openedGiftsCount++;
                // Ki·ªÉm tra xem ƒë√£ m·ªü h·∫øt qu√† ch∆∞a
                if (openedGiftsCount >= giftContainers.length) {
                    state = 2; // Chuy·ªÉn sang k·∫øt th√∫c
                    document.getElementById('final-text').style.opacity = 1;
                }
            }, 300);
        }

        function init() {
            resize();
            for (let i = 0; i < 2000; i++) particles.push(new Particle());
            animate();
        }

        // Click ƒë·ªÉ b·∫Øt ƒë·∫ßu
        canvas.addEventListener('click', () => {
            if (state === 0) {
                state = 1;
                particles.forEach(p => p.explode());
                createGifts();
            }
        });

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        function animate() {
            ctx.clearRect(0, 0, width, height);

            // G√≥c xoay
            angleY += 0.005;
            const cosY = Math.cos(angleY);
            const sinY = Math.sin(angleY);

            // V·∫Ω h·∫°t
            particles.forEach(p => {
                p.update();
                p.draw(cosY, sinY);
            });

            // V·∫Ω sao (ch·ªâ khi ch∆∞a n·ªï)
            drawStar(cosY, sinY);

            // C·∫≠p nh·∫≠t v·ªã tr√≠ qu√†
            updateGifts(angleY);

            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', resize);
        init();

    </script>
</body>
</html>